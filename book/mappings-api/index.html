<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Mappings API - Hybrid Network</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Hybrid Network Spec.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="affix"><a href="../index.html">Hybrid Network</a></li><li><a href="../architecture-overview/index.html"><strong aria-hidden="true">1.</strong> Architecture Overview</a></li><li><a href="../mechanism-design/index.html"><strong aria-hidden="true">2.</strong> Mechanism Design</a></li><li><a href="../query-processing/index.html"><strong aria-hidden="true">3.</strong> Query Processing</a></li><li><a href="../payment-channels/index.html"><strong aria-hidden="true">4.</strong> Payment Channels</a></li><li><a href="../read-interface/index.html"><strong aria-hidden="true">5.</strong> Read Interface</a></li><li><a href="../messages/index.html"><strong aria-hidden="true">6.</strong> Messages</a></li><li><a href="../rpc-api/index.html"><strong aria-hidden="true">7.</strong> JSON-RPC API</a></li><li><a href="../datasets/index.html"><strong aria-hidden="true">8.</strong> Datasets</a></li><li><a href="../data-modeling/index.html"><strong aria-hidden="true">9.</strong> Data Modeling</a></li><li><a href="../subgraph-manifest/index.html"><strong aria-hidden="true">10.</strong> Subgraph Manifest</a></li><li><a href="../mappings-api/index.html" class="active"><strong aria-hidden="true">11.</strong> Mappings API</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Hybrid Network</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#mappings-api" id="mappings-api">Mappings API</a></h1>
<h2><a class="header" href="#overview" id="overview">Overview</a></h2>
<p>Mappings define how data is extracted or ingested from one or more data sources, transformed, and then loaded in a format that follows a specific data model. At their core, mappings are simply WASM modules, and the mappings API is a set of host external functions that are injected into the WASM runtime and implement a specific interface. These function interfaces are in-protocol.</p>
<p>Additionally, extra-protocol APIs may be defined in userspace, which implement an API in a higher-level language that compiles to WASM. The Graph Protocol team created one such API, which is included here as a reference example.</p>
<h2><a class="header" href="#wasm-api" id="wasm-api">WASM API</a></h2>
<p>The Mappings API can be split into two portions, the <em>ingest</em> or <em>extract</em> API and the <em>store</em> API (how data is loaded). We present an ingest API tailored to event-sourcing Ethereum smart contract data, but future versions of the protocol will enable ingest APIs specific to other decentralized data sources. The <em>store API</em> will not need to change to support new data sources.</p>
<p><strong>Note:</strong> There are also a number of utility functions that are currently injected into the WASM runtime for convenience. These will either be implemented natively in WASM or fully specified in a future version of this spec.</p>
<h3><a class="header" href="#ingest" id="ingest">Ingest</a></h3>
<h4><a class="header" href="#ethereum" id="ethereum">Ethereum</a></h4>
<p>Data is ingested from Ethereum by event-sourcing Solidity events, as well as other triggers, defined in the subgraph manifest. The WASM module referenced in the subgraph manifest is expected to have handlers that correspond to the handlers defined in the <a href="../subgraph-manifest">subgraph manifest</a>.</p>
<p>See this <a href="https://github.com/graphprotocol/graph-node/blob/master/runtime/wasm/src/host.rs">reference implementation</a> for how these handlers should be called.</p>
<p>Additionally, we inject functions for calling Ethereum smart contracts for additional data that is not included in the Ethereum event:</p>
<ul>
<li>ethereum_call</li>
</ul>
<p>See this <a href="https://github.com/graphprotocol/graph-node/blob/master/runtime/wasm/src/host_exports.rs">reference</a> for these additional functions.</p>
<h3><a class="header" href="#store" id="store">Store</a></h3>
<p>The store API includes the following methods:</p>
<ul>
<li>set</li>
<li>get</li>
<li>remove</li>
</ul>
<p>See this <a href="https://github.com/graphprotocol/graph-node/blob/master/runtime/wasm/src/host_exports.rs">reference implementation</a> for these external functions.</p>
<h3><a class="header" href="#utilities" id="utilities">Utilities</a></h3>
<p>We currently inject the following utility functions into the WASM runtime, which may be changed or removed in a future version of the protocol:</p>
<ul>
<li>bytes_to_string</li>
<li>bytes_to_hex</li>
<li>big_int_to_hex</li>
<li>big_int_to_i32</li>
<li>json_to_i64</li>
<li>json_to_u64</li>
<li>json_to_f64</li>
<li>json_to_big_int</li>
<li>crypto_keccak_256</li>
<li>big_int_plus</li>
<li>big_int_minus</li>
<li>big_int_times</li>
<li>big_int_divided_by</li>
<li>big_int_mod</li>
<li>string_to_h160</li>
</ul>
<p>See this <a href="https://github.com/graphprotocol/graph-node/blob/master/runtime/wasm/src/host_exports.rs">reference implementation</a> for these external functions.</p>
<h2><a class="header" href="#higher-level-apis" id="higher-level-apis">Higher-Level APIs</a></h2>
<p>Higher-level APIs provide context for the low-level APIs, described above, in a higher-level programming language that compiles to WASM.</p>
<h3><a class="header" href="#assemblyscript" id="assemblyscript">AssemblyScript</a></h3>
<p><a href="https://github.com/AssemblyScript/assemblyscript/wiki">AssemblyScript</a> is a subset of TypeScript that compiles to WASM. It only natively supports a handful of types, 32 and 64-bit floating point and integer numeric types, but we extend the runtime with additional higher-level types, such as <code>TypedMap</code> and <code>BigInt</code>, to facilitate a more developer-friendly API.</p>
<p>See this <a href="https://github.com/graphprotocol/graph-ts/blob/master/index.ts">reference</a> for all types, external functions, and utilities.</p>
<h4><a class="header" href="#types" id="types">Types</a></h4>
<h5><a class="header" href="#basic-types" id="basic-types">Basic Types</a></h5>
<ul>
<li><code>TypedMap&lt;K, V&gt;</code></li>
<li><code>TypedMapEntry&lt;K, V&gt;</code></li>
<li><code>BytesArray</code></li>
<li><code>Bytes</code></li>
<li><code>BigInt</code></li>
<li><code>Value</code></li>
<li><code>ValueKind</code></li>
<li><code>ValuePayload</code></li>
</ul>
<h5><a class="header" href="#serialization-formats" id="serialization-formats">Serialization Formats</a></h5>
<ul>
<li><code>JSONValue</code></li>
<li><code>JSONValueKind</code></li>
<li><code>JSONValuePayload</code></li>
</ul>
<h5><a class="header" href="#ethereum-types" id="ethereum-types">Ethereum Types</a></h5>
<ul>
<li><code>EthereumValue</code></li>
<li><code>EthereumValueKind</code></li>
<li><code>EthereumBlock</code></li>
<li><code>EthereumTransaction</code></li>
<li><code>EthereumEvent</code></li>
<li><code>EthereumEventParams</code></li>
<li><code>SmartContractCall</code></li>
<li><code>SmartContract</code></li>
</ul>
<h5><a class="header" href="#store-types" id="store-types">Store Types</a></h5>
<ul>
<li><code>Entity</code></li>
</ul>
<h4><a class="header" href="#ingest-1" id="ingest-1">Ingest</a></h4>
<h5><a class="header" href="#ethereum-1" id="ethereum-1">Ethereum</a></h5>
<ul>
<li><code>ethereum.call</code></li>
</ul>
<h5><a class="header" href="#ipfs" id="ipfs">IPFS</a></h5>
<ul>
<li><code>ipfs.cat</code></li>
</ul>
<h4><a class="header" href="#store-1" id="store-1">Store</a></h4>
<ul>
<li><code>store.set</code></li>
<li><code>store.get</code></li>
<li><code>store.remove</code></li>
</ul>
<h4><a class="header" href="#utilities-1" id="utilities-1">Utilities</a></h4>
<ul>
<li><code>crypto.keccak256</code></li>
<li><code>json.fromBytes</code></li>
<li><code>json.toI64</code></li>
<li><code>json.toU64</code></li>
<li><code>json.toF64</code></li>
<li><code>json.toBigInt</code></li>
<li><code>typeConversion.bytesToString</code></li>
<li><code>typeConversion.bytesToHex</code></li>
<li><code>typeConversion.bigIntToString</code></li>
<li><code>typeConversion.stringToH160</code></li>
<li><code>typeConversion.i32ToBigInt</code></li>
<li><code>typeConversion.bigIntToI32</code></li>
<li><code>bigInt.plus</code></li>
<li><code>bigInt.minus</code></li>
<li><code>bigInt.times</code></li>
<li><code>bigInt.dividedBy</code></li>
<li><code>bigInt.mod</code></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../subgraph-manifest/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../subgraph-manifest/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
